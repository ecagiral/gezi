#{extends 'main.html' /}
#{set title:'#serbestsandik' /}

#{if flash.successMessage}	
	<div class="alert alert-success" style="background:green;font-size:12px !important;height:20px !important;margin:0 auto;width:250px;color:white;text-align:center;border:1px solid white">	
		${flash.successMessage}
	</div>
#{/if}
	
<div class="container-narrow">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
        #{if !connected}
          <li class="active"><a href="/login">Giriş / Üye Ol</a></li>
        #{/if}        
          <li><a href="/nedir">Nedir?</a></li>        
        #{else}
          <li style="margin:7px -7px 0 0">          
          	${connected?.username}<a style="color:red;padding-left:4px;display:inline;background:white" href="/logout">(Çıkış)</a>
          </li>          
        #{/else}          
        </ul>
        <a href="/" style="text-decoration:none;"><h3 class="muted">#serbestsandik</h3></a>        
      </div>
      <hr>
      <div class="jumbotron">
      			%{
      			def p =parent;
      			def ll =[]; 
      			while(p!= null){
      			 ll << p ;
      			 p = p.parent; 	
      			}
      			def reverse = ll.reverse()
      			}%
      			#{list reverse, as:'item'}
      				<a href="/${item.id}/0">
      					<span class="comment more">	      									        		
	        				${item.st_text}      					        			
        				</span>
        			</a>
        			#{if !item_isLast}<i class="icon-arrow-down"></i>#{/if}   
        		#{/list}
        		 
        		#{if positive==0}
	 	 		 	<a class="btn btn-large btn-success" href="/${parent.id}/1">Katılanları gör ( ${parent.positiveChild.size()} )</a>
        		 	<a class="btn btn-large btn-danger" href="/${parent.id}/-1">Katılmayanları gör ( ${parent.negativeChild.size()} )</a>
        		#{/if} 
        		#{elseif positive==1}
        		 	<i class="icon-arrow-down"></i>
        		#{/elseif} 
        		#{elseif positive==-1}
        		 	<i class="icon-arrow-down"></i>
        		#{/elseif}               
      </div>
    
      <div class="row-fluid marketing">
        <div class="span12">   
        	#{if !isFirst}       
        		#{if params.positive!="0"}
					<form  action="@{Application.addStatement}" method="POST" accept-charset="${_response_encoding}" autocomplete="off">
			 	 		<fieldset>  
			 	 		#{if params.positive=="1"} 		
			    			<textarea style="width:685px;" rows="3" placeholder="Katılıyorum çünkü..." name="text"></textarea>
			    		#{/if}
			    		#{elseif params.positive=="-1"}
			    			<textarea style="width:685px;" rows="3" placeholder="Katılmıyorum çünkü..." name="text"></textarea>			    		
			    		#{/elseif}
			    		<input type="hidden" name="parent" value="${parent.id}"/>
			    		<input type="hidden" name="positive" value='${params.positive}'/>
			    		<br>    		    	    
			    		<button type="submit" class="btn" style="float:right">Gönder</button>
			  			</fieldset>
					</form>					
				#{/if}
				
				#{if params.positive=="1"}
						<h3>Diğer katılanların fikirleri:</h3>
				#{/if}
				#{elseif params.positive=="-1"}
						<h3>Diğer katılmayanların fikirleri:</h3>
				#{/elseif}
							
				#{if params.positive=="1"}
					#{list parent.positiveChild}
						<span style="font-size:12px">
							${_.owner.username} /
						</span>
						<span style="font-size:12px">
							${_.entryDate.format('dd MMMM yyyy','tr')}
						</span>
						<div style="clear:both;">							
							
							<div style="float:left;margin-right:10px">							
								<div style="line-height:16px !important;margin:2px 0 5px 0;border:1px solid #ebebeb;width:540px;height:auto;padding:5px 0px 5px 5px">
									<span style="font-size:12px;">${_.st_text.raw()}</span>
								</div>
							</div>

                            <div style="float:left;position:relative;top:2px">
                                <form method="POST" action="@{Application.deleteStatement}">
                                    <input  type="hidden" name="id" value="${_.id}">
                                    <input  type="submit" class="btn btn-mini btn-danger" value="&nbsp;&nbsp;&nbsp;Sil" />
                                </form>
                            </div>
							<div style="float:left;position:relative;top:2px">
							    <form method="POST" action="@{Application.upvoteStatement}">
		        		 			<input  type="hidden" name="id" value="${_.id}">  
		        		 			<input  type="submit" class="btn btn-mini btn-info" value="&nbsp;&nbsp;&nbsp;Oyla" />
		        		 			<i class="icon-arrow-up upvote"></i>
	        		 			</form>        		 			
							</div>
							
							<div style="float:left;margin-left:10px;font-weight:bold;margin-top:2px;color:gray">
								<span>${_.point}</span>
							</div>
													
							<div style="clear:left;">
								<a class="btn btn-mini btn-success" href="/${_.id}/1">Katılıyorum</a>
	        		 			<a class="btn btn-mini btn-danger" href="/${_.id}/-1">Katılmıyorum</a>
	        		 		</div>
	        		 	</div>
	        		 	<br>
					#{/list}
					#{else}
						Henüz bir şey girilmemiş.
					#{/else}
				#{/if}
				#{elseif params.positive=="-1"}
					#{list parent.negativeChild}
						<span style="font-size:12px">
							${_.owner.username}
						</span>
						
						<div style="clear:both;">							
						
							<div style="float:left;margin-right:10px">							
								<div style="line-height:16px !important;margin:2px 0 5px 0;border:1px solid #ebebeb;width:540px;height:auto;padding:5px 0px 5px 5px">
									<span style="font-size:12px;">${_.st_text.raw()}</span>
								</div>
							</div>						
						
							<div style="float:left;position:relative;top:2px">
							    <form method="POST" action="@{Application.upvoteStatement}">
		        		 			<input  type="hidden" name="id" value="${_.id}">  
		        		 			<input  type="submit" class="btn btn-mini btn-info" value="&nbsp;&nbsp;&nbsp;Oyla" />
		        		 			<i class="icon-arrow-up upvote"></i>
	        		 			</form>        		 			
							</div>
						
							<div style="float:left;margin-left:10px;font-weight:bold;margin-top:2px;color:gray">
								<span>${_.point}</span>
							</div>
												
							<div style="clear:left;">
								<a class="btn btn-mini btn-success" href="/${_.id}/1">Katılıyorum</a>
	        		 			<a class="btn btn-mini btn-danger" href="/${_.id}/-1">Katılmıyorum</a>
	        		 		</div>
        		 		</div>
        		 		<br>
					#{/list}
					#{else}
						Henüz bir şey girilmemiş.
					#{/else}
				#{/elseif}
			#{/if}             
        </div>
      </div>
      <div class="footer"></div>
</div>
